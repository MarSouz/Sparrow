<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/dashboard/dashDesgaste.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="../assets/imgs/Logo2.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Sparrow | Dashboard análise de uso e desgaste</title>
</head>

<body>
    <div class="menu-lateral">
        <nav id="nav">
            <ul>
                <li>
                    <a href="#" class="logo">
                        <img src="../assets/imgs/Logo2.png" alt="">
                        <span class="nav-item">Sparrow</span>
                    </a>
                </li>

                <li>
                    <a href="./preDashAdm.html">
                        <i class="bx bxs-home"></i>
                        <span class="nav-item">Início</span>
                    </a>
                </li>

                <li>
                    <a href="./../AlteracoesFunc.html">
                        <i class="bx bxs-user"></i>
                        <span class="nav-item">Funcionários</span>
                    </a>
                </li>

                <li>
                    <a href="./dashAdm.html">
                        <i class="bx bx-radar"></i>
                        <span class="nav-item">Terminais</span>
                    </a>
                </li>

                <li>
                    <a href="./dashAdmServidor.html">
                        <i class="bx bxs-server"></i>
                        <span class="nav-item">Servidores</span>
                    </a>
                </li>

                <li>
                    <a href="./../crudTerminal.html">
                        <i class="bx bx-laptop"></i>
                        <span class="nav-item">Gerenciamento de terminais</span>
                    </a>
                </li>

                <li>
                    <a href="./../crudServidor.html">
                        <i class="bx bx-laptop"></i>
                        <span class="nav-item">Gerenciamento de servidores</span>
                    </a>
                </li>

                <li>
                    <a href="#">
                        <i class="bx bxs-help-circle"></i>
                        <span class="nav-item">Central de atendimento</span>
                    </a>
                </li>

                <li>
                    <a href="#" id="logoutBotao" class="logout">
                        <i class="bx bx-log-out"></i>
                        <span class="nav-item">Sair</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <div class="father">
        <div class="itemsUp">
            <div class="graficSem">
                <div class="backpage-coluns">
                    <div class="backpage-coluns-item">
                        <h2>Picos de uso diário</h2>
                    </div>
                    <div class="backpage-coluns-item">
                        <select name="" id="componentes">
                            <option value="cpu">CPU</option>
                            <option value="ram">RAM</option>
                            <option value="disk">Disco</option>
                        </select>
                    </div>
                </div>
                <canvas id="graficSm"></canvas>

            </div>

            <div class="graficBar">
                <div class="titleB">
                    <h2>Contador de ultrapassagem do limite</h2>
                </div>
                <canvas id="graficBar"></canvas>
            </div>
        </div>

        <div class="itemsDown">
            <div class="cardListar">
                <div class="titleL">
                    <select name="" id="">
                        <option value="">Terminais</option>
                        <option value="">Servidores</option>
                    </select>
                </div>

            </div>

            <div class="alerts">
                <div class="titleA">
                    <h2>Alertas</h2>
                </div>
            </div>
        </div>
    </div>

    <script>
// Configuração inicial do gráfico de linha
const data = {
    labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
    datasets: [{
        label: 'Uso (%)',
        // data: [20, 35, 50, 70, 65, 80, 40],  // Dados iniciais
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 2,
        fill: true,
    }]
};

// Configuração do gráfico
const config = {
    type: 'line', // Tipo do gráfico (linha)
    data: data,
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            title: {
                display: true,
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100 // Limite máximo de 100%
            }
        }
    }
};

// Renderizando o gráfico de linha
const ctx = document.getElementById('graficSm').getContext('2d');
const usageChart = new Chart(ctx, config);

document.getElementById('componentes').addEventListener('change', () => {
    fetch(`/grafico/dados-semana/${document.getElementById("componentes").value}`, {  // Corrigindo para usar GET e parâmetro na URL
        method: "GET",  
    })
        .then(response => {
            if (!response.ok) {
                throw new Error("Erro ao obter dados do gráfico semanal!");
            }
            return response.json(); 
        })
        .then(dados => {
            // Atualizar o gráfico de linha com os dados recebidos
            usageChart.data.datasets[0].data = dados.valores;  // Atualizando os dados de acordo com o componente selecionado
            usageChart.update(); // Atualiza o gráfico
        })
        .catch(error => {
            console.error("Erro no fetch:", error);
        });
});






        const dataB = {
            labels: ['CPU', 'RAM', 'DISCO'],
            datasets: [{
                label: 'Uso (%)',
                data: [2, 5, 4], 
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: true,
            }]
        };

        const configB = {
            type: 'bar',
            data: dataB,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10 
                    }
                }
            }
        };

        const ctxB = document.getElementById('graficBar').getContext('2d');
        const usageChartB = new Chart(ctxB, configB);
    </script>