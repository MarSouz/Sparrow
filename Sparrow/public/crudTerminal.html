<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="./css/alteracoesCrud.css">
    <link rel="stylesheet" href="./css/dashboard/dashAdm.css">
    <link rel="shortcut icon" href="assets/imgs/Logo2.png" type="image/x-icon">

    <title>Sparrow | Terminais</title>

</head>

<body onload="listar()">
    <section id="page-change">
        <div class="menu-lateral">
            <nav id="nav">
                <ul>
                    <li>
                        <a href="./../index.html" class="logo">
                            <img src="./assets/imgs/Logo2.png" alt="">
                            <span class="nav-item">Sparrow</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="./../index.html">
                            <i class="bx bxs-home"></i>
                            <span class="nav-item">Início</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="./AlteracoesFunc.html">
                            <i class="bx bxs-user"></i>
                            <span class="nav-item">Funcionários</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="./dashboard/dashAdm.html">
                            <i class="bx bx-radar"></i>
                            <span class="nav-item">Terminais</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="./dashboard/dashAdmServidor.html">
                            <i class="bx bxs-server"></i>
                            <span class="nav-item">Servidores</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="./crudTerminal.html">
                            <i class="bx bx-laptop"></i>
                            <span class="nav-item">Cadastro de terminais</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="./crudServidor.html">
                            <i class="bx bx-laptop"></i>
                            <span class="nav-item">Cadastro de servidores</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="#">
                            <i class="bx bxs-help-circle"></i>
                            <span class="nav-item">Central de atendimento</span>
                        </a>
                    </li>
    
                    <li>
                        <a href="#" class="logout">
                            <i class="bx bx-log-out"></i>
                            <span class="nav-item">Sair</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="father">
            <div class="child-backpage">

                <div class="child-backpage-title">
                    <h1>Gerenciamento de Terminais</h1>

                </div>

                <div class="child-backpage-table-func">
                    <div class="backpage-coluns">
                        <div class="backpage-coluns-item">
                            <p>ID</p>
                        </div>
                        <div class="backpage-coluns-item">
                            <p>Limite CPU</p>
                        </div>
                        <div class="backpage-coluns-item">
                            <p>Limite memória</p>
                        </div>
                        <div class="backpage-coluns-item">
                            <p>Limite disco</p>
                        </div>
                        <div class="backpage-coluns-item">
                            <p>Latitude/ Longitude </p>
                        </div>
                        <div class="backpage-coluns-item center">
                            <p>Editar</p>
                        </div>
                        <div class="backpage-coluns-item center">
                            <p>Excluir</p>
                        </div>
                    </div>

                    <div id="FUNCIONARIO" class="backpage-row">
                        <!-- CARD DO FUNCIONARIO -->

                        <!-- <div class="backpage-row-card-func">
                            <span>ID</span>
                            <span>CPU</span>
                            <span>Memória</span>
                            <span>Disco</span>
                            <span>Localização</span>

                            <div class="backpage-row-itemED">

                                <button onclick="edit_func()" class="editar" id>

                                </button>
                            </div>
                            <div class="backpage-row-itemEX">
                                <button onclick="remove_func()" class="deletar">

                                </button>
                            </div>
                        </div> -->
                    </div>
                </div>

            </div>
        </div>


    </section>

    <div id="edit-card" class="card-funcionario" style="display: none;">
        <div class="title">
            <h3>Editar terminal</h3>
            <div onclick="close_card('edit-card')" class="icon-close"><img src="./assets/svg/icon-close.svg" alt="">
            </div>
        </div>
        <div class="child-input">
            <div class="input field">
                <input type="input" class="campo" placeholder="cpu" required="" id="limiteCPU_input" autocomplete="off">
                <label for="name" class="caixa">Limite CPU</label>
            </div>

            <div class="input field">
                <input type="input" class="campo" placeholder="memoria" required="" id="limiteRAM_input"
                    autocomplete="off">
                <label for="name" class="caixa">Limite memória</label>
            </div>


            <div class="input field">
                <input type="input" class="campo" placeholder="disco" required="" id="limiteDisco_input"
                    autocomplete="off">
                <label for="name" class="caixa">Limite disco</label>
            </div>


            <div class="input field">
                <input type="input" class="campo" placeholder="latitude" required="" id="latitude_input"
                    autocomplete="off">
                <label for="name" class="caixa">Latitude</label>
            </div>


            <div class="input field">
                <input type="input" class="campo" placeholder="longitude" required="" id="longitude_input"
                    autocomplete="off">
                <label for="name" class="caixa">Longitude</label>
            </div>


        </div>
        <div class="btn">
            <button class="btn-save" onclick="salvar()">Salvar</button>
        </div>
    </div>



    <div id="card-confirm" class="card-confirm" style="display: none;">
        <div class="text">Deseja excluir este terminal?</div>
        <div class="btns">
            <button onclick="excluir()" class="btnEx">Excluir</button>
            <button onclick="cancelar()" class="btnC">Cancelar</button>
        </div>
    </div>

</body>

</html>

<script>

    // LISTAR
    function listar() {
        var longitudeVar = longitude_input.value;
        var latitudeVar = latitude_input.value;

        if (longitudeVar == "" || latitudeVar == "") {
            console.log("Campos vazios")
        }
        else {
            setInterval(5000)
        }

        console.log("FORM LONGITUDE: ", longitudeVar);
        console.log("FORM LATITUDE: ", latitudeVar);


        fetch(`/medidas/buscar/${sessionStorage.ID_EMPRESA}/${2}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    console.log("error")
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    for (var index = 0; index < resposta.length; index++) {
                        var maquina = resposta[index]

                        console.log(maquina)
                        var div_maquina = document.createElement("div")
                        var spanID = document.createElement("span");
                        var spanCpu = document.createElement("span");
                        var spanMemoria = document.createElement("span");
                        var spanDisco = document.createElement("span");
                        var spanLocalização = document.createElement("span");
                        var btnEditar = document.createElement("button");
                        var btnDeletar = document.createElement("button");
                        var divEditar = document.createElement("div")
                        var divDeletar = document.createElement("div")


                        spanID.innerHTML = "<b>" + maquina.id + "</b>";
                        spanCpu.innerHTML = "<b>" + maquina.CPU + "</b>";
                        spanMemoria.innerHTML = "<b>" + maquina.RAM + "</b>";
                        spanDisco.innerHTML = "<b>" + maquina.Disco + "</b>";
                        spanLocalização.innerHTML = "<b>" + maquina.lat + "/" + maquina.lon + "</b>";

                        btnEditar.innerHTML = '<img src="./assets/svg/icon-pencil.svg" alt="Editar">';
                        btnDeletar.innerHTML = '<img src="./assets/svg/icon-lixeira.svg" alt="Deletar">';

                        btnEditar.className = "backpage-row-itemED"
                        btnEditar.id = "btnEditar" + maquina.lat + maquina.lon;
                        btnEditar.setAttribute("onclick", `editar('${maquina.id}', '${maquina.CPU}', '${maquina.RAM}', '${maquina.Disco}', '${maquina.lat}', '${maquina.lon}')`);

                        btnDeletar.className = "backpage-row-itemEX"
                        btnDeletar.id = "btnDeletar" + maquina.id;
                        btnDeletar.setAttribute("onclick", `remove_func()`);

                        div_maquina.className = "backpage-row-card-func"
                        div_maquina.id = maquina.id
                        divEditar.className = "backpage-row-itemED"
                        divDeletar.className = "backpage-row-itemEX"
                        divEditar.appendChild(btnEditar)
                        divDeletar.appendChild(btnDeletar)


                        div_maquina.appendChild(spanID)
                        div_maquina.appendChild(spanCpu)
                        div_maquina.appendChild(spanMemoria)
                        div_maquina.appendChild(spanDisco)
                        div_maquina.appendChild(spanLocalização)
                        div_maquina.appendChild(divEditar)
                        div_maquina.appendChild(divDeletar)

                        FUNCIONARIO.appendChild(div_maquina)
                    }
                }

                )
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }

    function salvar() {
        var longitudeVar = Number(longitude_input.value);
        var latitudeVar = Number(latitude_input.value);
        var limiteCPUVar = Number(limiteCPU_input.value);
        var limiteRAMVar = Number(limiteRAM_input.value);
        var limiteDiscoVar = Number(limiteDisco_input.value);

        fetch(`/medidas/editar/${sessionStorage.getItem("ID_MAQUINA")}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                longitudeServer: longitudeVar,
                latitudeServer: latitudeVar,
                limiteCPUServer: limiteCPUVar,
                limiteRamServer: limiteRAMVar,
                limiteDiscoServer: limiteDiscoVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                window.location = "crudTerminal.html"

                // resposta.json().then(json => {
                //     console.log(json);
                //     console.log(JSON.stringify(json));
                //     sessionStorage.ID_MAQUINA = json.id;

                // });

            } else {

                console.log("Houve um erro ou editar a máquina!");

                resposta.text().then(texto => {
                    console.error(texto);

                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function editar(id, cpu, memoria, disco, latitude, longitude) {
        sessionStorage.ID_MAQUINA = id
        limiteCPU_input.value = cpu
        limiteRAM_input.value = memoria,
            limiteDisco_input.value = disco,
            latitude_input.value = latitude,
            longitude_input.value = longitude

        var edit = document.getElementById("edit-card");
        edit.style.display = "block";
    }

    function edit_func() {
        var id = sessionStorage.ID_MAQUINA
        var cpu = limiteCPU_input.value
        var ram = limiteRAM_input.value
        var disco = limiteDisco_input.value
        var latitude = latitude_input.value
        var longitude = longitude_input.value

        fetch(`/medidas/editar/${Number(id)}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                longitudeServer: longitude,
                latitudeServer: latitude,
                limiteCPUServer: cpu,
                limiteRamServer: ram,
                limiteDiscoServer: disco,
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                window.location = "crudTerminal.html"
            } else if (resposta.status == 404) {

            } else {
                throw ("Houve um erro. Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`ERRO: ${resposta}`);
        });

        var edit = document.getElementById("edit-card");
        edit.style.display = "block";
    }

    function close_card(cardId) { //do editar
        var card = document.getElementById(cardId)
        card.style.display = "none"
    }


    // EXCLUIR 
    function excluir(id) {
        fetch(`/medidas/deletar/${sessionStorage.getItem("ID_MAQUINA")}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            if (resposta.ok) {
                console.log("Post deletado com sucesso pelo usuario de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
                window.location = "crudTerminal.html"

            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }


    function remove_func() { //do excluir 
        var remove = document.getElementById("card-confirm")
        remove.style.display = "flex"
    }

    function cancelar() {
        var cancel = document.getElementById("card-confirm")
        cancel.style.display = "none"
    }




</script>